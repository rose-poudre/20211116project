<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>情報入力</title>
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/second.css" />
    <style></style>
  </head>
  <body>
    <section>
      <div>
        <h2>現在の情報を入力してください</h2>
        <p class="caption">
          身長(cm): <input type="number" id="height" class="input-frame" />
        </p>
        <p class="caption">
          体重(kg): <input type="number" id="weight" class="input-frame" />
        </p>
        <p class="caption">
          年齢(歳): <input type="number" id="age" class="input-frame" />
        </p>
        <p class="select-box select-box-title">
          活動レベル:
          <select name="" id="select" class="select-box-list"></select>
        </p>
        <p><input type="button" value="計算" id="calc" class="next-btn" /></p>
        <p class="kcal-title">1日の摂取カロリー</p>
        <p id="result"></p>
        <p class="caption">
          目標体重: <input type="number" id="goal_weight" class="input-frame" />
        </p>
        <p class="caption">
          目標期限: <input type="text" id="goal_date" class="input-frame" />
        </p>
        <br />
        <button id="button" class="next-btn">complete</button><br />
        <button id="button_next" class="next-btn">LET'S GO!!</button>
      </div>
    </section>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
      ///////// 選択タブ（活動レベル）///////////
      const mix = {
        text: [
          "ほぼ運動しない.通勤・デスクワーク程度",
          "軽い運動.週に1〜2回程度の運動",
          "中程度の運動.週に3〜5回程度の運動",
          "激しい運動.週に6〜7回程度の運動",
          "非常に激しい運動.1日に2回程度の運動",
        ],
        number: [1.2, 1.375, 1.55, 1.725, 1.9],
      };
      // optionタグの生成
      const start = 0;
      const end = 4;
      let option = "";
      for (let i = start; i <= end; i++) {
        option += "<option>" + mix.text[i] + "</option>";
      }
      $("#select").html(option);

      ///////////計算///////////
      $("#calc").on("click", function () {
        let h = Number($("#height").val());
        let w = Number($("#weight").val());
        let a = Number($("#age").val());
        if ($("#select").val() === mix.text[0]) {
          $("#result").html(
            ((66 + 13.7 * w + 5 * h - 6.8 * a) * mix.number[0]).toFixed() +
              "cal"
          );
        } else if ($("#select").val() === mix.text[1]) {
          $("#result").html(
            ((66 + 13.7 * w + 5 * h - 6.8 * a) * mix.number[1]).toFixed() +
              "cal"
          );
        } else if ($("#select").val() === mix.text[2]) {
          $("#result").html(
            ((66 + 13.7 * w + 5 * h - 6.8 * a) * mix.number[2]).toFixed() +
              "cal"
          );
        } else if ($("#select").val() === mix.text[3]) {
          $("#result").html(
            ((66 + 13.7 * w + 5 * h - 6.8 * a) * mix.number[3]).toFixed() +
              "cal"
          );
        } else {
          $("#result").html(
            ((66 + 13.7 * w + 5 * h - 6.8 * a) * mix.number[4]).toFixed() +
              "kcal"
          );
        }
      });
    </script>

    <script type="module">
      "use strict";
      //firebaseを利用するためのコード
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-app.js";

      //firestoreを使うためのコード
      import {
        //import内は使用する関数を定義
        getFirestore,
        collection,
        doc,
        addDoc,
        getDoc,
        setDoc,
        updateDoc,
        deleteDoc,
        deleteField,
        serverTimestamp,
        query,
        orderBy,
        onSnapshot,
        Timestamp,
      } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-firestore.js"; //importに定義したのをfirestoreで使用

      const firebaseConfig = {
        apiKey: "AIzaSyCjJjAbvkARxiEdRgxXopqIOmkWOxaFOXs",
        authDomain: "work-js.firebaseapp.com",
        projectId: "work-js",
        storageBucket: "work-js.appspot.com",
        messagingSenderId: "649608969811",
        appId: "1:649608969811:web:29e1bb2d8ca0c646d810a6",
      };

      //Firebaseを利用するための変数
      const app = initializeApp(firebaseConfig);

      //Firestoreを利用するための変数
      const db = getFirestore(app);

      ////////////////入力画面///////////////////////////////
      $("#button").on("click", function () {
        // 送信時に必要な処理
        const data = {
          goalday: $("#goal_date").val(),
          targetweight: $("#goal_weight").val(),
          totalcal: $("#result").html(),
        };
        alert("ok");
        // console.log(data);
        addDoc(collection(db, "personal"), data);
      });

      /////////////////////ページ遷移////////////////////////
      $("#button_next").on("click", function () {
        location.href = "./index.html";
      });
    </script>
  </body>
</html>
